# 星耀特性数据库扩展指南

## 概述

星耀特性数据库采用内嵌JSON格式，存储在 `zi_wei_xingyao.cpp` 文件中。您可以直接修改JSON数据来扩展或更新星耀信息，**无需修改其他C++代码**。

## JSON数据位置

文件：`ZhouYiLab/src/zi_wei/zi_wei_xingyao.cpp`

变量名：`XING_YAO_JSON_DATABASE`（第44行左右）

## JSON数据格式

### 整体结构

```json
{
  "主星": [ ... ],
  "辅星": [ ... ],
  "煞星": [ ... ],
  "杂耀": [ ... ]
}
```

### 单个星耀条目格式

```json
{
  "name": "星耀名称",
  "te_xing": ["特性1", "特性2", ...],
  "wu_xing": "五行属性",
  "yin_yang": "阴阳属性",
  "xing_qing": "星情描述",
  "zhu_shi": "主管事项"
}
```

## 字段说明

### 1. name（星耀名称）
- **类型**：字符串
- **说明**：星耀的中文名称
- **示例**：`"紫微"`, `"天机"`, `"太阳"`

### 2. te_xing（特性列表）
- **类型**：字符串数组
- **允许值**：
  - `"桃花星"` - 桃花星
  - `"财星"` - 财星
  - `"权星"` - 权星
  - `"文星"` - 文星
  - `"寿星"` - 寿星
  - `"驿马星"` - 驿马星
  - `"孤星"` - 孤独星
  - `"吉星"` - 吉星
  - `"煞星"` - 煞星
  - `"主星"` - 主星（14正曜）
  - `"辅星"` - 辅星
  - `"杂耀"` - 杂耀
- **示例**：`["主星", "权星"]`, `["辅星", "文星", "吉星"]`

### 3. wu_xing（五行属性）
- **类型**：字符串
- **允许值**：`"金"`, `"木"`, `"水"`, `"火"`, `"土"`
- **示例**：`"土"`, `"木"`, `"火"`

### 4. yin_yang（阴阳属性）
- **类型**：字符串
- **允许值**：`"阳"`, `"阴"`
- **示例**：`"阳"`, `"阴"`

### 5. xing_qing（星情描述）
- **类型**：字符串
- **说明**：星耀的性质、特点描述
- **示例**：`"帝座，尊贵之星"`, `"智慧之星，善变谋略"`

### 6. zhu_shi（主管事项）
- **类型**：字符串
- **说明**：星耀主管的事务、影响范围
- **示例**：`"官禄、权贵、领导"`, `"智慧、机巧、兄弟"`

## 添加新星耀示例

### 示例1：添加一颗杂耀

在 `"杂耀"` 数组中添加：

```json
{
  "name": "天才",
  "te_xing": ["杂耀", "文星"],
  "wu_xing": "木",
  "yin_yang": "阳",
  "xing_qing": "聪明才智之星",
  "zhu_shi": "才华、智慧、学业"
}
```

### 示例2：添加一颗桃花星

在 `"杂耀"` 数组中添加：

```json
{
  "name": "沐浴",
  "te_xing": ["杂耀", "桃花星"],
  "wu_xing": "水",
  "yin_yang": "阴",
  "xing_qing": "桃花、沐浴更衣",
  "zhu_shi": "桃花、感情、洗涤"
}
```

### 示例3：修改现有星耀

找到对应星耀，修改其属性：

```json
{
  "name": "天机",
  "te_xing": ["主星", "文星"],  // 保持原有
  "wu_xing": "木",
  "yin_yang": "阳",
  "xing_qing": "智慧之星，善变谋略，兄弟主星",  // 修改描述
  "zhu_shi": "智慧、机巧、兄弟、谋略、变动"  // 扩展主事
}
```

## 完整添加步骤

### 步骤1：打开文件
打开 `ZhouYiLab/src/zi_wei/zi_wei_xingyao.cpp`

### 步骤2：定位JSON数据
找到第44行左右的 `XING_YAO_JSON_DATABASE` 变量

### 步骤3：选择分类
根据星耀类型，在对应分类中添加：
- 14主星 → `"主星"` 数组
- 6吉星 → `"辅星"` 数组
- 6煞星 → `"煞星"` 数组
- 其他星耀 → `"杂耀"` 数组

### 步骤4：添加JSON条目
在对应数组的末尾添加（**注意逗号**）：

```json
{
  "name": "您的星耀名称",
  "te_xing": ["特性1", "特性2"],
  "wu_xing": "五行",
  "yin_yang": "阴阳",
  "xing_qing": "星情描述",
  "zhu_shi": "主管事项"
}
```

### 步骤5：验证JSON格式
确保：
- 所有字符串使用双引号 `"`
- 对象之间用逗号 `,` 分隔
- 最后一个对象后面不要加逗号
- 数组元素用逗号分隔

### 步骤6：重新编译
```bash
cd ZhouYiLab
cmake --build cmake-build-debug
```

## 注意事项

### ⚠️ JSON格式要求

1. **字符串必须用双引号**
   - ✅ 正确：`"name": "紫微"`
   - ❌ 错误：`'name': '紫微'` 或 `name: "紫微"`

2. **数组元素逗号分隔**
   - ✅ 正确：`["主星", "权星"]`
   - ❌ 错误：`["主星" "权星"]`

3. **最后一个元素不加逗号**
   ```json
   {
     "name": "紫微",
     "te_xing": ["主星"],
     "wu_xing": "土"  // ← 最后一个字段，不加逗号
   }
   ```

4. **中文使用UTF-8编码**
   确保文件保存为UTF-8编码

### 🔧 调试技巧

如果添加后程序出错：

1. **检查JSON格式**
   使用在线JSON验证工具：https://jsonlint.com/
   
2. **查看编译错误**
   ```bash
   cmake --build cmake-build-debug 2>&1 | grep -i "json\|parse"
   ```

3. **检查字段拼写**
   确保 `name`, `te_xing`, `wu_xing`, `yin_yang`, `xing_qing`, `zhu_shi` 拼写正确

## 数据库查询示例

添加星耀后，可以通过以下方式使用：

```cpp
// 获取星耀信息
auto info = get_xing_yao_info("您添加的星耀名称");

// 判断特性
bool is_tao_hua = is_tao_hua_xing("您添加的星耀名称");
bool is_cai = is_cai_xing("您添加的星耀名称");

// 获取所有某类型星耀
auto all_tao_hua = get_all_tao_hua_xing();  // 包含新添加的桃花星
```

## 当前已包含的星耀

### 主星（14颗）
紫微、天机、太阳、武曲、天同、廉贞、天府、太阴、贪狼、巨门、天相、天梁、七杀、破军

### 辅星（6颗）
左辅、右弼、文昌、文曲、天魁、天钺

### 煞星（6颗）
擎羊、陀罗、火星、铃星、地空、地劫

### 杂耀（部分）
禄存、天马、红鸾、天喜、咸池、孤辰、寡宿、天寿、天刑、天姚、天巫、天月、阴煞、解神、天德、月德

## 后续扩展建议

可以继续添加的星耀：
- 三台、八座
- 恩光、天贵
- 龙池、凤阁
- 天才、天寿
- 台辅、封诰
- 天官、天福
- 天厨
- 华盖
- 破碎
- 天空
- 旬空
- 截路、空亡
- 天哭、天虚
- 年解
- 等等...

## 技术细节

### JSON解析流程

1. **编译时嵌入**：JSON字符串在编译时嵌入到可执行文件中
2. **首次访问解析**：第一次调用 `get_xing_yao_info()` 时解析JSON
3. **单例缓存**：解析后的数据缓存在静态map中，后续访问直接查表
4. **错误处理**：如果JSON格式错误，会输出错误信息并返回空数据库

### 性能优化

- ✅ JSON只解析一次（单例模式）
- ✅ 查询使用hash map（O(1)时间复杂度）
- ✅ 无运行时文件IO（全部编译期嵌入）

## 问题排查

### Q: 添加后查询不到新星耀？
A: 检查：
1. JSON格式是否正确
2. 是否重新编译了项目
3. 星耀名称是否完全匹配（区分大小写）

### Q: 编译时JSON解析错误？
A: 检查：
1. 是否有语法错误（逗号、引号、括号）
2. 是否有中文编码问题
3. 查看编译输出的具体错误信息

### Q: 如何调试JSON内容？
A: 可以临时添加调试代码：
```cpp
fmt::print("JSON数据库内容:\n{}\n", XING_YAO_JSON_DATABASE);
```

## 总结

通过修改内嵌JSON字符串，您可以：
- ✅ 添加新星耀
- ✅ 修改星耀属性
- ✅ 更新星情描述
- ✅ 扩展星耀特性

**无需修改任何C++代码逻辑！**

